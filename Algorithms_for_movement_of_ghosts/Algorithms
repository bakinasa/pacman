Принцип движения призраков.




Рассмотрим аспекты, объединяющие всех полтергейстов.

Поведения можно разделить на 3 типа: преследование, страх и "разбегания". Большую часть времени призраки находятся в режиме погони,
используя положение Пакмена как фактор выбора клетки, куда они передвинутся. В режиме разбегания каждый призрак уходит "патрулировать"
свой угол поля, пока не заметит Пакмена. Режим страха включается, когда Пакмен съедает энерджайзер - призраки становятся синими и двигаются медленне,
псевдослучайно выбирая направление на перекрестках. Продолжительность этого режима уменьшается с увеличением уровня.

Для чередования режимов удобно использовать таймер: Разбегание примерно 7 секунд, затем погоня в течении 20 секунд.
Если Пакмен съедает энерджайзер, то после 20 секунд страха таймер обнуляется и поведение повторяется.
В случае смерти Пакмена призраки снова оказываются в домике.
С увеличением уровня время погони увеличивается, а время разбегания уменьшается.





Закономерности движения

Когда необходимо принять решение, призрак выбирает прилегающую клетку, которая поставит его ближе по прямой линии к цели.
Измеряется расстояние от возможной клетки движения до целевой и выбирает та, которая ближе.

Так же полтергейсты не могут менять напраление на противоположное. Призраки думают лишь на один шаг в будущее, когда движутся в лабиринте.
Всякий раз, когда призрак ступает на клетку он смотрит вперед на следующую и смотрит куда он повернет, когда достигнет ее.
Получается, когда призрак входит на клетку лишь с двумя выходами, он не может выбрать тот, откуда пришел,
и всегда будет продолжать идти в том же направлении.
Но при смене режима все призраки меняют направления движения на противоположные.





Условия домика:
У каждого призрака должнен быть свой счетчик, считающий кол-во точек, съедаемых Пакменом.
он сбрасыватеся на нуль в начале уровня и активен только внутри дома. У каждого призрака активируются счетчики по очереди.
За каждую съеденную точку к активному счетчику прибавляется единица.
У каждого призрака есть лимит точек, при котором он покидает дом.

Если предпочтительный призрак достигает или превышает свой предел точек, он немедленно покидает дом, и его счетчик точек отключается (но не сбрасывается).
Наиболее предпочтительный призрак, все еще ожидающий внутри дома (если есть), активирует свой таймер в этот момент и начинает считать точки.

Каждый раз, когда теряется жизнь, система отключает (но не сбрасывает) индивидуальные счетчики точек призраков и вместо этого использует глобальный
счетчик точек. Этот счетчик включается и сбрасывается в ноль после потери жизни, считая количество съеденных точек с этого момента.

Три призрака в доме должны ждать, пока этот специальный счетчик скажет им, когда им нужно уходить. Пинки освобождается, когда значение счетчика
становится равным 7, а Инки освобождается, когда оно становится равным 17. Единственный способ деактивировать счетчик - это, чтобы Клайд был внутри дома,
когда значение счетчика равно 32; в противном случае он будет продолжать считать точки даже после того, как дом-призрак опустеет.

Если Клайд присутствует в соответствующее время, глобальный счетчик сбрасывается на ноль и деактивируется, а личные ограничения призраков снова
включаются и используются, как и раньше, для определения того, когда выйти из дома (включая Клайда, который все еще находится в доме. на данный момент).

Так же существует счетчик, считающий время со съедения Пакменом последний точки.
Этот таймер всегда работает, но сбрасывается на ноль каждый раз, когда съедается точка.

Каждый раз, когда таймер достигает своего предела(на 1 уровне 4 секунды, но с 5 уровня - 3 секунды), наиболее предпочтительный
призрак, ожидающий в доме призраков (если таковой имеется), вынужден немедленно уйти, а таймер сбрасывается на ноль.

Обычно при выходе из дома призраки двигаются влево и затем вниз, но если выход совпадет со сменой режима, то это будет едиственным случаем, когда
при выходе полтергейсты двинутся вправо.




Индивидуальные особенности


Режим разбегания

В этом режиме каждый призрак имеет предопределенную клетку, расположенную за границами лабиринта около углов.
Когда начинается этот режим, каждый призрак направляется в сторону своего угла и начинает движение согласно обычному алгоритма поиска пути.
Однако, поскольку их цели недоступны, а призраки не могут остановиться или развернуться, они пытаются достичь свою цель,
разворачиваясь и возвращаясь к ней снова. В результате чего путь каждого привидения со временем превращается в петлю около своего угла.


Блинки - красный призрак

Выходит первым.
Верхний правый угол.
Клетка Блинки в режиме преследования определяется текущей клеткой Пакмэна.
Блинки почти всегда непосредственно преследует пэкмэна, до тех пор, пока из-за недальновидного принятия решений он не выберет неэффективный путь.


Пинки - Розовое привидение

Выходит вторым.
Предел точек: 0
Верхний левый угол.
Целевая клетка Пинки определяется в соответствии с текущей позицией и направлением пэкмэна и выбирает позицию на четыре клетки перед ним.
(В оригинальном коде игры был баг, из-за которого когда Пакмэн направлялся вверх,
клетка Пинки устанавливалась на четыре клетки перед Пакмэном и четыре слева от него.)


Инки - Синий полтергейст

Предел точек на 1 уровне: 30
Предел точек на 2 уровне: 0
Выходит третьим.
Нижний правый угол.
Инки не бросается выходит из домика пока Пакмен не съест как минимум 30 точек.
Метод передвижения Инки примерно таков: он выбирает клетку на две клетки перед пэкменом (почти как Пинки),
затем смотрит вектор от Блинки до этой точки и удваевает его. Конец вектора и будет целевя клетка Инки.

Таким образом цель Инки может быть где угодно, пока Блинки не близко с Пакменом, но если Блинки удалось сблизиться, Инки сделает то же самое.


Клайд - Оранжевый призрак

Предел точек на 1 уровне: 60
Предел точек на 2 уровне: 50
Предел точек на 3 уровне: 0
Выходит последним.
Нижний левый угол.
Последнее привидение остается в доме пока как минимум треть точек не будет съедена.
У Клайда два режима, которые переключаются в зависимости от  удаленности Пакмена. Клайд вычисляет вычисляет расстояние до Пакмена.
Если оно больше 8 клеток, то его целью является сам Пакмен. Однако если расстояние до Пакмена становится менее восьми клеток,
его клетка устанавливается там же, где она была бы в режиме разбегания, неподалеку от левого нижнего угла лабиринта.
